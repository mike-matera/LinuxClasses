
### Commands 

  * update-grub

### Configuration 

  * /etc/default/grub
  * /etc/grub.d/
  * /boot/grub/

## Further Reading 

[https://www.gnu.org/software/grub/manual/](https://www.gnu.org/software/grub/manual/)

## Introduction to GRUB 

GRUB is short for the GRand Unified Bootloader. It's the program responsible for bringing Linux off of the hard disk or other boot medium and into RAM. If you're familiar with Linux you've seen GRUB many times but perhaps never interacted with it. Usually you don't have to unless it's an emergency. GRUB has a BASH-like command shell that can be activated by pressing any key when you see the GRUB boot menu.

## GRUB Configuration 

On Ubuntu GRUB's configuration is spread out. This is 
```
/etc/default/grub
GRUB_DEFAULT=0
#GRUB_HIDDEN_TIMEOUT=0
GRUB_HIDDEN_TIMEOUT_QUIET=true
GRUB_TIMEOUT=10
GRUB_DISTRIBUTOR=`lsb_release -i -s 2> /dev/null || echo Debian`
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash nomdmonddf nomdmonisw nomdmonddf nomdmonisw nomdmonddf nomdmonisw"
GRUB_CMDLINE_LINUX=""
# Uncomment to enable BadRAM filtering, modify to suit your needs
# This works with Linux (no patch required) and with any kernel that obtains
# the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...)
#GRUB_BADRAM="0x01234567,0xfefefefe,0x89abcdef,0xefefefef"
# Uncomment to disable graphical terminal (grub-pc only)
#GRUB_TERMINAL=console
# The resolution used on graphical terminal
# note that you can use only modes which your graphic card supports via VBE
# you can see them in real GRUB with the command `vbeinfo'
#GRUB_GFXMODE=640x480
# Uncomment if you don't want GRUB to pass "root=UUID=xxx" parameter to Linux
#GRUB_DISABLE_LINUX_UUID=true
# Uncomment to disable generation of recovery mode menu entries
#GRUB_DISABLE_RECOVERY="true"
# Uncomment to get a beep at grub start
#GRUB_INIT_TUNE="480 440 1"
```

Most of the things that are easy to tune are located here. The GRUB boot menu is generated when you run the command:

```
# sudo update-grub
```

That command uses the scripts located in /etc/grub.d

```
# ls -l /etc/grub.d
total 76
-rwxr-xr-x 1 root root 9424 Jun 26 04:16 00_header
-rwxr-xr-x 1 root root 6058 May 8 2014 05_debian_theme
-rwxr-xr-x 1 root root 11608 May 15 2014 10_linux
-rwxr-xr-x 1 root root 10412 May 15 2014 20_linux_xen
-rwxr-xr-x 1 root root 1992 Mar 12 2014 20_memtest86+
-rwxr-xr-x 1 root root 11692 May 15 2014 30_os-prober
-rwxr-xr-x 1 root root 1416 May 15 2014 30_uefi-firmware
-rwxr-xr-x 1 root root  214 Apr 9 2013 40_custom
-rwxr-xr-x 1 root root  216 Apr 9 2013 41_custom
-rw-r--r-- 1 root root  483 Apr 9 2013 README
```

Notice that the file names have numbers. This is because they're run in order: 00 first and 99 last. GRUB cannot see into complex Linux partitions (like LVM) so the 
```
/boot
```

 partition is usually formatted with the ext2 filesystem. When you run update-grub GRUB's generated configuration is placed into 
```
/boot
```

. Here's an example of grub.cfg

```
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#
### BEGIN /etc/grub.d/00_header ###
if [ -s $prefix/grubenv ]; then
 set have_grubenv=true
 load_env
fi
if [ "${next_entry}" ] ; then
 set default="${next_entry}"
 set next_entry=
 save_env next_entry
 set boot_once=true
else
 set default="0"
fi
if [ x"${feature_menuentry_id}" = xy ]; then
 menuentry_id_option="--id"
else
 menuentry_id_option=""
fi
export menuentry_id_option
if [ "${prev_saved_entry}" ]; then
 set saved_entry="${prev_saved_entry}"
 save_env saved_entry
 set prev_saved_entry=
 save_env prev_saved_entry
 set boot_once=true
fi
function savedefault {
 if [ -z "${boot_once}" ]; then
  saved_entry="${chosen}"
  save_env saved_entry
 fi
}
function recordfail {
 set recordfail=1
 if [ -n "${have_grubenv}" ]; then if [ -z "${boot_once}" ]; then save_env recordfail; fi; fi
}
function load_video {
 if [ x$feature_all_video_module = xy ]; then
  insmod all_video
 else
  insmod efi_gop
  insmod efi_uga
  insmod ieee1275_fb
  insmod vbe
  insmod vga
  insmod video_bochs
  insmod video_cirrus
 fi
}
if [ x$feature_default_font_path = xy ] ; then
 font=unicode
else
insmod part_msdos
insmod part_msdos
insmod lvm
insmod ext2
set root='lvmid/SE3nYs-PV4x-Xlmo-poMR-N4nm-9jNb-yB0Twf/6R9aFn-EHrQ-MQsJ-QIhk-cSMx-IqfT-IeGePa'
if [ x$feature_platform_search_hint = xy ]; then
 search --no-floppy --fs-uuid --set=root --hint='lvmid/SE3nYs-PV4x-Xlmo-poMR-N4nm-9jNb-yB0Twf/6R9aFn-EHrQ-MQsJ-QIhk-cSMx-IqfT-IeGePa' 3a51e625-1863-4a2c-8e01-dedcc778d7c2
else
 search --no-floppy --fs-uuid --set=root 3a51e625-1863-4a2c-8e01-dedcc778d7c2
fi
  font="/usr/share/grub/unicode.pf2"
fi
if loadfont $font ; then
 set gfxmode=auto
 load_video
 insmod gfxterm
 set locale_dir=$prefix/locale
 set lang=en_US
 insmod gettext
fi
terminal_output gfxterm
if [ "${recordfail}" = 1 ] ; then
 set timeout=30
else
 if [ x$feature_timeout_style = xy ] ; then
  set timeout_style=menu
  set timeout=10
 # Fallback normal timeout code in case the timeout_style feature is
 # unavailable.
 else
  set timeout=10
 fi
fi
### END /etc/grub.d/00_header ###
### BEGIN /etc/grub.d/05_debian_theme ###
set menu_color_normal=white/black
set menu_color_highlight=black/light-gray
if background_color 44,0,30,0; then
 clear
fi
### END /etc/grub.d/05_debian_theme ###
### BEGIN /etc/grub.d/10_linux ###
function gfxmode {
set gfxpayload="${1}"
if [ "${1}" = "keep" ]; then
set vt_handoff=vt.handoff=7
else
set vt_handoff=
fi
}
if [ "${recordfail}" != 1 ]; then
 if [ -e ${prefix}/gfxblacklist.txt ]; then
  if hwmatch ${prefix}/gfxblacklist.txt 3; then
   if [ ${match} = 0 ]; then
    set linux_gfx_mode=keep
   else
    set linux_gfx_mode=text
   fi
  else
   set linux_gfx_mode=text
  fi
 else
  set linux_gfx_mode=keep
 fi
else
 set linux_gfx_mode=text
fi
export linux_gfx_mode
menuentry 'Ubuntu' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-3a51e625-1863-4a2c-8e01-dedcc778d7c2' {
recordfail
load_video
gfxmode $linux_gfx_mode
insmod gzio
insmod part_msdos
insmod ext2
set root='hd0,msdos1'
if [ x$feature_platform_search_hint = xy ]; then
 search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 75f5ce48-1b75-4e4f-b36f-8028834acbe9
else
 search --no-floppy --fs-uuid --set=root 75f5ce48-1b75-4e4f-b36f-8028834acbe9
fi
linux
/vmlinuz-3.13.0-63-generic root=/dev/mapper/ubuntu--vg-root ro quiet splash nomdmonddf nomdmonisw nomdmonddf nomdmonisw nomdmonddf nomdmonisw $vt_handoff
initrd
/initrd.img-3.13.0-63-generic
}
submenu 'Advanced options for Ubuntu' $menuentry_id_option 'gnulinux-advanced-3a51e625-1863-4a2c-8e01-dedcc778d7c2' {
menuentry 'Ubuntu, with Linux 3.13.0-63-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-3.13.0-63-generic-advanced-3a51e625-1863-4a2c-8e01-dedcc778d7c2' {
recordfail
load_video
gfxmode $linux_gfx_mode
insmod gzio
insmod part_msdos
insmod ext2
set root='hd0,msdos1'
if [ x$feature_platform_search_hint = xy ]; then
 search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 75f5ce48-1b75-4e4f-b36f-8028834acbe9
else
 search --no-floppy --fs-uuid --set=root 75f5ce48-1b75-4e4f-b36f-8028834acbe9
fi
echo
'Loading Linux 3.13.0-63-generic ...'
linux
/vmlinuz-3.13.0-63-generic root=/dev/mapper/ubuntu--vg-root ro quiet splash nomdmonddf nomdmonisw nomdmonddf nomdmonisw nomdmonddf nomdmonisw $vt_handoff
echo
'Loading initial ramdisk ...'
initrd
/initrd.img-3.13.0-63-generic
}
menuentry 'Ubuntu, with Linux 3.13.0-63-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-3.13.0-63-generic-recovery-3a51e625-1863-4a2c-8e01-dedcc778d7c2' {
recordfail
load_video
insmod gzio
insmod part_msdos
insmod ext2
set root='hd0,msdos1'
if [ x$feature_platform_search_hint = xy ]; then
 search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 75f5ce48-1b75-4e4f-b36f-8028834acbe9
else
 search --no-floppy --fs-uuid --set=root 75f5ce48-1b75-4e4f-b36f-8028834acbe9
fi
echo
'Loading Linux 3.13.0-63-generic ...'
linux
/vmlinuz-3.13.0-63-generic root=/dev/mapper/ubuntu--vg-root ro recovery nomodeset
echo
'Loading initial ramdisk ...'
initrd
/initrd.img-3.13.0-63-generic
}
}
### END /etc/grub.d/10_linux ###
### BEGIN /etc/grub.d/20_linux_xen ###
### END /etc/grub.d/20_linux_xen ###
### BEGIN /etc/grub.d/20_memtest86+ ###
menuentry 'Memory test (memtest86+)' {
insmod part_msdos
insmod ext2
set root='hd0,msdos1'
if [ x$feature_platform_search_hint = xy ]; then
 search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 75f5ce48-1b75-4e4f-b36f-8028834acbe9
else
 search --no-floppy --fs-uuid --set=root 75f5ce48-1b75-4e4f-b36f-8028834acbe9
fi
knetbsd
/memtest86+.elf
}
menuentry 'Memory test (memtest86+, serial console 115200)' {
insmod part_msdos
insmod ext2
set root='hd0,msdos1'
if [ x$feature_platform_search_hint = xy ]; then
 search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 75f5ce48-1b75-4e4f-b36f-8028834acbe9
else
 search --no-floppy --fs-uuid --set=root 75f5ce48-1b75-4e4f-b36f-8028834acbe9
fi
linux16
/memtest86+.bin console=ttyS0,115200n8
}
### END /etc/grub.d/20_memtest86+ ###
### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###
### BEGIN /etc/grub.d/30_uefi-firmware ###
### END /etc/grub.d/30_uefi-firmware ###
### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries. Simply type the
# menu entries you want to add after this comment. Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###
### BEGIN /etc/grub.d/41_custom ###
if [ -f ${config_directory}/custom.cfg ]; then
 source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f $prefix/custom.cfg ]; then
 source $prefix/custom.cfg;
fi
### END /etc/grub.d/41_custom ###
```

